[Unit]
Description={{ media_app_name | capitalize }} Daemon
RequiresMountsFor={{ media_app_root}} /tank/media/downloads /tank/media/arr_suite/movies
Wants=network-online.target sabnzbdplus.service prowlarr.service
After=network-online.target sabnzbdplus.service prowlarr.service

[Service]
Type=simple
User={{ media_app_name }}
Group=media
UMask=0002
WorkingDirectory=/srv/{{ media_app_name }}
RuntimeDirectory={{ media_app_name }}

ExecStart={{ media_app_root }}/app/{{ media_app_name | capitalize }} -nobrowser -data=/srv/{{ media_app_name }}/data

# Restart & shutdown behavior
Restart=on-failure
RestartSec=5s
KillMode=mixed
KillSignal=SIGINT
TimeoutStopSec=30s

# Journald
StandardOutput=journal
StandardError=journal
SyslogIdentifier={{ media_app_name }}
LogRateLimitIntervalSec=30s
LogRateLimitBurst=300

# Core hardening
NoNewPrivileges=true
PrivateTmp=true
PrivateDevices=true
ProtectSystem=strict
ProtectHome=true
ProtectClock=true
ProtectHostname=true
ProtectKernelTunables=true
ProtectKernelModules=true
ProtectKernelLogs=true
ProtectControlGroups=true
ProtectProc=invisible
ProcSubset=pid
RestrictSUIDSGID=true
LockPersonality=true
MemoryDenyWriteExecute=false
RestrictNamespaces=true
RestrictRealtime=true
SystemCallArchitectures=native
CapabilityBoundingSet=
AmbientCapabilities=
RestrictAddressFamilies=AF_INET AF_INET6 AF_UNIX
SystemCallErrorNumber=EPERM
SystemCallFilter=@system-service @basic-io @file-system @network-io @process @signal @memlock
SystemCallFilter=~ @mount @raw-io @reboot @swap @module @debug

# Bind Mounts
BindReadOnlyPaths={{ media_app_root }}/app:/srv/{{ media_app_name }}/app
BindPaths={{ media_app_root }}/data:/srv/{{ media_app_name }}/data
BindPaths=/tank/media/downloads:/srv/downloads
BindPaths=/tank/media/arr_suite/movies:/srv/movies

ReadWritePaths=/srv/{{ media_app_name }}/data /srv/downloads /srv/movies

[Install]
WantedBy=multi-user.target
